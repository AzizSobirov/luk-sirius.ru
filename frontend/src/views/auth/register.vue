<template>
  <section class="login">
    <form @submit.prevent="signUp()" class="login__form">
      <h1>АНКЕТА</h1>
      <h3>кандидата на участие в Образовательном проекте Компании «Лукойл»</h3>
      <h4>ИНФОРМАЦИЯ ОБ УЧАСТНИКЕ</h4>
      <div class="login__content">
        <div class="login__item">
          <h4>Фамилия</h4>
          <span>
            <input
              type="text"
              name="surname"
              v-model="surname"
              placeholder=""
              minlength="3"
              required
            />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M15 16L11 20H21V16H15ZM12.06 7.19002L3 16.25V20H6.75L15.81 10.94L12.06 7.19002ZM5.92 18H5V17.08L12.06 10L13 10.94L5.92 18ZM18.71 8.04002C19.1 7.65002 19.1 7.00002 18.71 6.63002L16.37 4.29002C16.1825 4.10401 15.9291 3.99963 15.665 3.99963C15.4009 3.99963 15.1475 4.10401 14.96 4.29002L13.13 6.12002L16.88 9.87002L18.71 8.04002Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <div class="login__item">
          <h4>Имя</h4>
          <span>
            <input
              type="text"
              name="name"
              v-model="name"
              placeholder=""
              minlength="3"
              required
            />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M15 16L11 20H21V16H15ZM12.06 7.19002L3 16.25V20H6.75L15.81 10.94L12.06 7.19002ZM5.92 18H5V17.08L12.06 10L13 10.94L5.92 18ZM18.71 8.04002C19.1 7.65002 19.1 7.00002 18.71 6.63002L16.37 4.29002C16.1825 4.10401 15.9291 3.99963 15.665 3.99963C15.4009 3.99963 15.1475 4.10401 14.96 4.29002L13.13 6.12002L16.88 9.87002L18.71 8.04002Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <div class="login__item">
          <h4>Отчество</h4>
          <span>
            <input
              type="text"
              name="father"
              v-model="father"
              placeholder=""
              minlength="3"
              required
            />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M15 16L11 20H21V16H15ZM12.06 7.19002L3 16.25V20H6.75L15.81 10.94L12.06 7.19002ZM5.92 18H5V17.08L12.06 10L13 10.94L5.92 18ZM18.71 8.04002C19.1 7.65002 19.1 7.00002 18.71 6.63002L16.37 4.29002C16.1825 4.10401 15.9291 3.99963 15.665 3.99963C15.4009 3.99963 15.1475 4.10401 14.96 4.29002L13.13 6.12002L16.88 9.87002L18.71 8.04002Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <div class="login__item">
          <h4>Дата рождения</h4>
          <span>
            <input
              type="date"
              v-model="datar"
              name="date"
              id="date-inp"
              placeholder="01.01.2023"
              required
            />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="25"
              height="25"
              viewBox="0 0 25 25"
              fill="none"
            >
              <path
                d="M9.81171 11.5H7.81171V13.5H9.81171V11.5ZM13.8117 11.5H11.8117V13.5H13.8117V11.5ZM17.8117 11.5H15.8117V13.5H17.8117V11.5ZM19.8117 4.5H18.8117V2.5H16.8117V4.5H8.81171V2.5H6.81171V4.5H5.81171C4.70171 4.5 3.82171 5.4 3.82171 6.5L3.81171 20.5C3.81171 21.0304 4.02242 21.5391 4.39749 21.9142C4.77257 22.2893 5.28127 22.5 5.81171 22.5H19.8117C20.9117 22.5 21.8117 21.6 21.8117 20.5V6.5C21.8117 5.4 20.9117 4.5 19.8117 4.5ZM19.8117 20.5H5.81171V9.5H19.8117V20.5Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <!-- snils -->
        <div class="login__item">
          <h4>СНИЛС</h4>
          <span :class="{ invalid: !isSnilsValid }">
            <input
              type="text"
              v-model="snils"
              name="mask"
              v-mask="'000-000-000-00'"
              placeholder="123-145-41-11"
              @input="checkUser()"
              required
            />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <g clip-path="url(#clip0_19_98)">
                <path
                  d="M18 2C18.5304 2 19.0391 2.21071 19.4142 2.58579C19.7893 2.96086 20 3.46957 20 4V21C20 21.5304 19.7893 22.0391 19.4142 22.4142C19.0391 22.7893 18.5304 23 18 23H6C5.46957 23 4.96086 22.7893 4.58579 22.4142C4.21071 22.0391 4 21.5304 4 21V4C4 3.46957 4.21071 2.96086 4.58579 2.58579C4.96086 2.21071 5.46957 2 6 2H18ZM18 4H6V21H18V4ZM14 16C14.2652 16 14.5196 16.1054 14.7071 16.2929C14.8946 16.4804 15 16.7348 15 17C15 17.2652 14.8946 17.5196 14.7071 17.7071C14.5196 17.8946 14.2652 18 14 18H10C9.73478 18 9.48043 17.8946 9.29289 17.7071C9.10536 17.5196 9 17.2652 9 17C9 16.7348 9.10536 16.4804 9.29289 16.2929C9.48043 16.1054 9.73478 16 10 16H14ZM12 6C13.0609 6 14.0783 6.42143 14.8284 7.17157C15.5786 7.92172 16 8.93913 16 10C16 11.0609 15.5786 12.0783 14.8284 12.8284C14.0783 13.5786 13.0609 14 12 14C10.9391 14 9.92172 13.5786 9.17157 12.8284C8.42143 12.0783 8 11.0609 8 10C8 8.93913 8.42143 7.92172 9.17157 7.17157C9.92172 6.42143 10.9391 6 12 6ZM12 8C11.4696 8 10.9609 8.21071 10.5858 8.58579C10.2107 8.96086 10 9.46957 10 10C10 10.5304 10.2107 11.0391 10.5858 11.4142C10.9609 11.7893 11.4696 12 12 12C12.5304 12 13.0391 11.7893 13.4142 11.4142C13.7893 11.0391 14 10.5304 14 10C14 9.46957 13.7893 8.96086 13.4142 8.58579C13.0391 8.21071 12.5304 8 12 8Z"
                  fill="#1967D2"
                />
              </g>
              <defs>
                <clipPath id="clip0_19_98">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>
          </span>
          <p class="error" v-if="!isSnilsValid">СНИЛС недействительный</p>
        </div>

        <div class="login__item">
          <h4>Название организации</h4>
          <span>
            <select v-model="school" required>
              <option v-for="i in store.SpisokObshestv" :key="i">
                {{ i }}
              </option>
            </select>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M6.25 12C6.05109 12 5.86032 12.079 5.71967 12.2197C5.57902 12.3603 5.5 12.5511 5.5 12.75C5.5 12.9489 5.57902 13.1397 5.71967 13.2803C5.86032 13.421 6.05109 13.5 6.25 13.5H6.75C6.94891 13.5 7.13968 13.421 7.28033 13.2803C7.42098 13.1397 7.5 12.9489 7.5 12.75C7.5 12.5511 7.42098 12.3603 7.28033 12.2197C7.13968 12.079 6.94891 12 6.75 12H6.25ZM5.5 9.25C5.5 9.05109 5.57902 8.86032 5.71967 8.71967C5.86032 8.57902 6.05109 8.5 6.25 8.5H6.75C6.94891 8.5 7.13968 8.57902 7.28033 8.71967C7.42098 8.86032 7.5 9.05109 7.5 9.25C7.5 9.44891 7.42098 9.63968 7.28033 9.78033C7.13968 9.92098 6.94891 10 6.75 10H6.25C6.05109 10 5.86032 9.92098 5.71967 9.78033C5.57902 9.63968 5.5 9.44891 5.5 9.25ZM6.25 5C6.05109 5 5.86032 5.07902 5.71967 5.21967C5.57902 5.36032 5.5 5.55109 5.5 5.75C5.5 5.94891 5.57902 6.13968 5.71967 6.28033C5.86032 6.42098 6.05109 6.5 6.25 6.5H6.75C6.94891 6.5 7.13968 6.42098 7.28033 6.28033C7.42098 6.13968 7.5 5.94891 7.5 5.75C7.5 5.55109 7.42098 5.36032 7.28033 5.21967C7.13968 5.07902 6.94891 5 6.75 5H6.25ZM9 12.75C9 12.5511 9.07902 12.3603 9.21967 12.2197C9.36032 12.079 9.55109 12 9.75 12H10.25C10.4489 12 10.6397 12.079 10.7803 12.2197C10.921 12.3603 11 12.5511 11 12.75C11 12.9489 10.921 13.1397 10.7803 13.2803C10.6397 13.421 10.4489 13.5 10.25 13.5H9.75C9.55109 13.5 9.36032 13.421 9.21967 13.2803C9.07902 13.1397 9 12.9489 9 12.75ZM9.75 8.5C9.55109 8.5 9.36032 8.57902 9.21967 8.71967C9.07902 8.86032 9 9.05109 9 9.25C9 9.44891 9.07902 9.63968 9.21967 9.78033C9.36032 9.92098 9.55109 10 9.75 10H10.25C10.4489 10 10.6397 9.92098 10.7803 9.78033C10.921 9.63968 11 9.44891 11 9.25C11 9.05109 10.921 8.86032 10.7803 8.71967C10.6397 8.57902 10.4489 8.5 10.25 8.5H9.75ZM9 5.75C9 5.55109 9.07902 5.36032 9.21967 5.21967C9.36032 5.07902 9.55109 5 9.75 5H10.25C10.4489 5 10.6397 5.07902 10.7803 5.21967C10.921 5.36032 11 5.55109 11 5.75C11 5.94891 10.921 6.13968 10.7803 6.28033C10.6397 6.42098 10.4489 6.5 10.25 6.5H9.75C9.55109 6.5 9.36032 6.42098 9.21967 6.28033C9.07902 6.13968 9 5.94891 9 5.75ZM13.25 12C13.0511 12 12.8603 12.079 12.7197 12.2197C12.579 12.3603 12.5 12.5511 12.5 12.75C12.5 12.9489 12.579 13.1397 12.7197 13.2803C12.8603 13.421 13.0511 13.5 13.25 13.5H13.75C13.9489 13.5 14.1397 13.421 14.2803 13.2803C14.421 13.1397 14.5 12.9489 14.5 12.75C14.5 12.5511 14.421 12.3603 14.2803 12.2197C14.1397 12.079 13.9489 12 13.75 12H13.25ZM12.5 9.25C12.5 9.05109 12.579 8.86032 12.7197 8.71967C12.8603 8.57902 13.0511 8.5 13.25 8.5H13.75C13.9489 8.5 14.1397 8.57902 14.2803 8.71967C14.421 8.86032 14.5 9.05109 14.5 9.25C14.5 9.44891 14.421 9.63968 14.2803 9.78033C14.1397 9.92098 13.9489 10 13.75 10H13.25C13.0511 10 12.8603 9.92098 12.7197 9.78033C12.579 9.63968 12.5 9.44891 12.5 9.25ZM13.25 5C13.0511 5 12.8603 5.07902 12.7197 5.21967C12.579 5.36032 12.5 5.55109 12.5 5.75C12.5 5.94891 12.579 6.13968 12.7197 6.28033C12.8603 6.42098 13.0511 6.5 13.25 6.5H13.75C13.9489 6.5 14.1397 6.42098 14.2803 6.28033C14.421 6.13968 14.5 5.94891 14.5 5.75C14.5 5.55109 14.421 5.36032 14.2803 5.21967C14.1397 5.07902 13.9489 5 13.75 5H13.25Z"
                fill="#1967D2"
              />
              <path
                d="M2 20V3C2 2.46957 2.21071 1.96086 2.58579 1.58579C2.96086 1.21071 3.46957 1 4 1H16C16.5304 1 17.0391 1.21071 17.4142 1.58579C17.7893 1.96086 18 2.46957 18 3V20C18 20.173 17.978 20.34 17.937 20.5H20C20.1326 20.5 20.2598 20.4473 20.3536 20.3536C20.4473 20.2598 20.5 20.1326 20.5 20V12C20.5 11.9224 20.4819 11.8458 20.4472 11.7764C20.4125 11.707 20.3621 11.6466 20.3 11.6L19.8 11.225C19.6409 11.1057 19.5357 10.928 19.5075 10.7311C19.4794 10.5342 19.5307 10.3341 19.65 10.175C19.7693 10.0159 19.947 9.91067 20.1439 9.88254C20.3408 9.85441 20.5409 9.90565 20.7 10.025L21.2 10.4C21.704 10.778 22 11.37 22 12V20C22 20.5304 21.7893 21.0391 21.4142 21.4142C21.0391 21.7893 20.5304 22 20 22H16.438C16.3822 22.0001 16.3265 21.994 16.272 21.982C16.183 21.994 16.092 22 16 22H12.25C12.0511 22 11.8603 21.921 11.7197 21.7803C11.579 21.6397 11.5 21.4489 11.5 21.25V19H8.5V21.25C8.5 21.4489 8.42098 21.6397 8.28033 21.7803C8.13968 21.921 7.94891 22 7.75 22H4C3.46957 22 2.96086 21.7893 2.58579 21.4142C2.21071 21.0391 2 20.5304 2 20ZM4 20.5H7V18.25C7 18.0511 7.07902 17.8603 7.21967 17.7197C7.36032 17.579 7.55109 17.5 7.75 17.5H12.25C12.4489 17.5 12.6397 17.579 12.7803 17.7197C12.921 17.8603 13 18.0511 13 18.25V20.5H16C16.1326 20.5 16.2598 20.4473 16.3536 20.3536C16.4473 20.2598 16.5 20.1326 16.5 20V3C16.5 2.86739 16.4473 2.74021 16.3536 2.64645C16.2598 2.55268 16.1326 2.5 16 2.5H4C3.86739 2.5 3.74021 2.55268 3.64645 2.64645C3.55268 2.74021 3.5 2.86739 3.5 3V20C3.5 20.1326 3.55268 20.2598 3.64645 20.3536C3.74021 20.4473 3.86739 20.5 4 20.5Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <div class="login__item">
          <h4>Класс обучения</h4>
          <span>
            <select v-model="klass" required>
              <option v-for="i in klasses" :key="i">
                {{ i }}
              </option>
            </select>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="21"
              height="21"
              viewBox="0 0 21 21"
              fill="none"
            >
              <path
                d="M17.5068 8.44532L11.2568 14.6953C11.1374 14.8108 10.9777 14.8754 10.8115 14.8754C10.6453 14.8754 10.4857 14.8108 10.3662 14.6953L4.11621 8.44532C4.03142 8.35495 3.97395 8.24242 3.95045 8.12076C3.92695 7.99909 3.93837 7.87326 3.9834 7.75782C4.03121 7.64406 4.11163 7.54701 4.21451 7.47889C4.31739 7.41076 4.43813 7.37462 4.56152 7.375H17.0615C17.1849 7.37462 17.3057 7.41076 17.4085 7.47889C17.5114 7.54701 17.5918 7.64406 17.6396 7.75782C17.6847 7.87326 17.6961 7.99909 17.6726 8.12076C17.6491 8.24242 17.5916 8.35495 17.5068 8.44532Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <div v-if="department_selection" class="login__item department">
          <h4>Департамент</h4>
          <span>
            <select v-model="department" required>
              <option v-for="i in store.departments" :key="i">
                {{ i }}
              </option>
            </select>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M6.25 12C6.05109 12 5.86032 12.079 5.71967 12.2197C5.57902 12.3603 5.5 12.5511 5.5 12.75C5.5 12.9489 5.57902 13.1397 5.71967 13.2803C5.86032 13.421 6.05109 13.5 6.25 13.5H6.75C6.94891 13.5 7.13968 13.421 7.28033 13.2803C7.42098 13.1397 7.5 12.9489 7.5 12.75C7.5 12.5511 7.42098 12.3603 7.28033 12.2197C7.13968 12.079 6.94891 12 6.75 12H6.25ZM5.5 9.25C5.5 9.05109 5.57902 8.86032 5.71967 8.71967C5.86032 8.57902 6.05109 8.5 6.25 8.5H6.75C6.94891 8.5 7.13968 8.57902 7.28033 8.71967C7.42098 8.86032 7.5 9.05109 7.5 9.25C7.5 9.44891 7.42098 9.63968 7.28033 9.78033C7.13968 9.92098 6.94891 10 6.75 10H6.25C6.05109 10 5.86032 9.92098 5.71967 9.78033C5.57902 9.63968 5.5 9.44891 5.5 9.25ZM6.25 5C6.05109 5 5.86032 5.07902 5.71967 5.21967C5.57902 5.36032 5.5 5.55109 5.5 5.75C5.5 5.94891 5.57902 6.13968 5.71967 6.28033C5.86032 6.42098 6.05109 6.5 6.25 6.5H6.75C6.94891 6.5 7.13968 6.42098 7.28033 6.28033C7.42098 6.13968 7.5 5.94891 7.5 5.75C7.5 5.55109 7.42098 5.36032 7.28033 5.21967C7.13968 5.07902 6.94891 5 6.75 5H6.25ZM9 12.75C9 12.5511 9.07902 12.3603 9.21967 12.2197C9.36032 12.079 9.55109 12 9.75 12H10.25C10.4489 12 10.6397 12.079 10.7803 12.2197C10.921 12.3603 11 12.5511 11 12.75C11 12.9489 10.921 13.1397 10.7803 13.2803C10.6397 13.421 10.4489 13.5 10.25 13.5H9.75C9.55109 13.5 9.36032 13.421 9.21967 13.2803C9.07902 13.1397 9 12.9489 9 12.75ZM9.75 8.5C9.55109 8.5 9.36032 8.57902 9.21967 8.71967C9.07902 8.86032 9 9.05109 9 9.25C9 9.44891 9.07902 9.63968 9.21967 9.78033C9.36032 9.92098 9.55109 10 9.75 10H10.25C10.4489 10 10.6397 9.92098 10.7803 9.78033C10.921 9.63968 11 9.44891 11 9.25C11 9.05109 10.921 8.86032 10.7803 8.71967C10.6397 8.57902 10.4489 8.5 10.25 8.5H9.75ZM9 5.75C9 5.55109 9.07902 5.36032 9.21967 5.21967C9.36032 5.07902 9.55109 5 9.75 5H10.25C10.4489 5 10.6397 5.07902 10.7803 5.21967C10.921 5.36032 11 5.55109 11 5.75C11 5.94891 10.921 6.13968 10.7803 6.28033C10.6397 6.42098 10.4489 6.5 10.25 6.5H9.75C9.55109 6.5 9.36032 6.42098 9.21967 6.28033C9.07902 6.13968 9 5.94891 9 5.75ZM13.25 12C13.0511 12 12.8603 12.079 12.7197 12.2197C12.579 12.3603 12.5 12.5511 12.5 12.75C12.5 12.9489 12.579 13.1397 12.7197 13.2803C12.8603 13.421 13.0511 13.5 13.25 13.5H13.75C13.9489 13.5 14.1397 13.421 14.2803 13.2803C14.421 13.1397 14.5 12.9489 14.5 12.75C14.5 12.5511 14.421 12.3603 14.2803 12.2197C14.1397 12.079 13.9489 12 13.75 12H13.25ZM12.5 9.25C12.5 9.05109 12.579 8.86032 12.7197 8.71967C12.8603 8.57902 13.0511 8.5 13.25 8.5H13.75C13.9489 8.5 14.1397 8.57902 14.2803 8.71967C14.421 8.86032 14.5 9.05109 14.5 9.25C14.5 9.44891 14.421 9.63968 14.2803 9.78033C14.1397 9.92098 13.9489 10 13.75 10H13.25C13.0511 10 12.8603 9.92098 12.7197 9.78033C12.579 9.63968 12.5 9.44891 12.5 9.25ZM13.25 5C13.0511 5 12.8603 5.07902 12.7197 5.21967C12.579 5.36032 12.5 5.55109 12.5 5.75C12.5 5.94891 12.579 6.13968 12.7197 6.28033C12.8603 6.42098 13.0511 6.5 13.25 6.5H13.75C13.9489 6.5 14.1397 6.42098 14.2803 6.28033C14.421 6.13968 14.5 5.94891 14.5 5.75C14.5 5.55109 14.421 5.36032 14.2803 5.21967C14.1397 5.07902 13.9489 5 13.75 5H13.25Z"
                fill="#1967D2"
              />
              <path
                d="M2 20V3C2 2.46957 2.21071 1.96086 2.58579 1.58579C2.96086 1.21071 3.46957 1 4 1H16C16.5304 1 17.0391 1.21071 17.4142 1.58579C17.7893 1.96086 18 2.46957 18 3V20C18 20.173 17.978 20.34 17.937 20.5H20C20.1326 20.5 20.2598 20.4473 20.3536 20.3536C20.4473 20.2598 20.5 20.1326 20.5 20V12C20.5 11.9224 20.4819 11.8458 20.4472 11.7764C20.4125 11.707 20.3621 11.6466 20.3 11.6L19.8 11.225C19.6409 11.1057 19.5357 10.928 19.5075 10.7311C19.4794 10.5342 19.5307 10.3341 19.65 10.175C19.7693 10.0159 19.947 9.91067 20.1439 9.88254C20.3408 9.85441 20.5409 9.90565 20.7 10.025L21.2 10.4C21.704 10.778 22 11.37 22 12V20C22 20.5304 21.7893 21.0391 21.4142 21.4142C21.0391 21.7893 20.5304 22 20 22H16.438C16.3822 22.0001 16.3265 21.994 16.272 21.982C16.183 21.994 16.092 22 16 22H12.25C12.0511 22 11.8603 21.921 11.7197 21.7803C11.579 21.6397 11.5 21.4489 11.5 21.25V19H8.5V21.25C8.5 21.4489 8.42098 21.6397 8.28033 21.7803C8.13968 21.921 7.94891 22 7.75 22H4C3.46957 22 2.96086 21.7893 2.58579 21.4142C2.21071 21.0391 2 20.5304 2 20ZM4 20.5H7V18.25C7 18.0511 7.07902 17.8603 7.21967 17.7197C7.36032 17.579 7.55109 17.5 7.75 17.5H12.25C12.4489 17.5 12.6397 17.579 12.7803 17.7197C12.921 17.8603 13 18.0511 13 18.25V20.5H16C16.1326 20.5 16.2598 20.4473 16.3536 20.3536C16.4473 20.2598 16.5 20.1326 16.5 20V3C16.5 2.86739 16.4473 2.74021 16.3536 2.64645C16.2598 2.55268 16.1326 2.5 16 2.5H4C3.86739 2.5 3.74021 2.55268 3.64645 2.64645C3.55268 2.74021 3.5 2.86739 3.5 3V20C3.5 20.1326 3.55268 20.2598 3.64645 20.3536C3.74021 20.4473 3.86739 20.5 4 20.5Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <div class="login__item">
          <h4>Период</h4>
          <span>
            <select id="dataPotoka" required>
              <option v-for="i in dataPotokas" :key="i">
                {{ i }}
              </option>
            </select>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="21"
              height="21"
              viewBox="0 0 21 21"
              fill="none"
            >
              <path
                d="M17.5068 8.44532L11.2568 14.6953C11.1374 14.8108 10.9777 14.8754 10.8115 14.8754C10.6453 14.8754 10.4857 14.8108 10.3662 14.6953L4.11621 8.44532C4.03142 8.35495 3.97395 8.24242 3.95045 8.12076C3.92695 7.99909 3.93837 7.87326 3.9834 7.75782C4.03121 7.64406 4.11163 7.54701 4.21451 7.47889C4.31739 7.41076 4.43813 7.37462 4.56152 7.375H17.0615C17.1849 7.37462 17.3057 7.41076 17.4085 7.47889C17.5114 7.54701 17.5918 7.64406 17.6396 7.75782C17.6847 7.87326 17.6961 7.99909 17.6726 8.12076C17.6491 8.24242 17.5916 8.35495 17.5068 8.44532Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>

        <div class="login__item">
          <h4>Контактный номер с Telegram (ребенка)</h4>
          <span>
            <input
              type="text"
              v-model="tel"
              name="mask"
              v-mask="'+# (###) ###-##-##'"
              placeholder="+7 983 307 32 02"
              minlength="18"
              maxlength="18"
              required
            />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16.64 8.8C16.49 10.38 15.84 14.22 15.51 15.99C15.37 16.74 15.09 16.99 14.83 17.02C14.25 17.07 13.81 16.64 13.25 16.27C12.37 15.69 11.87 15.33 11.02 14.77C10.03 14.12 10.67 13.76 11.24 13.18C11.39 13.03 13.95 10.7 14 10.49C14.0069 10.4582 14.006 10.4252 13.9973 10.3938C13.9886 10.3624 13.9724 10.3337 13.95 10.31C13.89 10.26 13.81 10.28 13.74 10.29C13.65 10.31 12.25 11.24 9.52 13.08C9.12 13.35 8.76 13.49 8.44 13.48C8.08 13.47 7.4 13.28 6.89 13.11C6.26 12.91 5.77 12.8 5.81 12.45C5.83 12.27 6.08 12.09 6.55 11.9C9.47 10.63 11.41 9.79 12.38 9.39C15.16 8.23 15.73 8.03 16.11 8.03C16.19 8.03 16.38 8.05 16.5 8.15C16.6 8.23 16.63 8.34 16.64 8.42C16.63 8.48 16.65 8.66 16.64 8.8Z"
                fill="#1967D2"
              />
            </svg>
          </span>
        </div>
        <div class="login__item">
          <h4>Согласие на обработку персональных данных</h4>
          <span>
            <div class="PersDannie">
              <input
                name="PersDannie"
                type="checkbox"
                autocomplete="off"
                v-model="PersD"
              />
              <a href="https://sirius.espp.su/persd.html"
                >Я даю согласие на обработку персональных данных.</a
              >
            </div>
          </span>
        </div>
        <div class="login__item">
          <button type="submit" :disabled="btnDisabled">
            Далее
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M13.3 17.275C13.1 17.075 13.004 16.8334 13.012 16.55C13.0207 16.2667 13.125 16.025 13.325 15.825L16.15 13H5C4.71667 13 4.479 12.904 4.287 12.712C4.09567 12.5207 4 12.2834 4 12C4 11.7167 4.09567 11.479 4.287 11.287C4.479 11.0957 4.71667 11 5 11H16.15L13.3 8.15005C13.1 7.95005 13 7.71238 13 7.43705C13 7.16238 13.1 6.92505 13.3 6.72505C13.5 6.52505 13.7377 6.42505 14.013 6.42505C14.2877 6.42505 14.525 6.52505 14.725 6.72505L19.3 11.3C19.4 11.4 19.471 11.5084 19.513 11.625C19.5543 11.7417 19.575 11.8667 19.575 12C19.575 12.1334 19.5543 12.2584 19.513 12.375C19.471 12.4917 19.4 12.6 19.3 12.7L14.7 17.3C14.5167 17.4834 14.2877 17.575 14.013 17.575C13.7377 17.575 13.5 17.475 13.3 17.275Z"
                fill="white"
              />
            </svg>
          </button>
        </div>
      </div>
    </form>
  </section>
</template>

<script setup>
import { ref, onMounted, computed } from "vue";
import { useRouter } from "vue-router";
import { useStore } from "@/store/index";
// import axios from "axios";
import { useSnilsValidator } from "@/composables.js";
import { usePopupStore } from "@/components/ThePopup";
import http from "@/libs/axios.js";

const popup = usePopupStore();
const router = useRouter();
const store = useStore();

// variables
const name = ref("");
const surname = ref("");
const father = ref("");
const snils = ref("");
const datar = ref("");
const school = ref(store.SpisokObshestv[0]);
const klass = ref("");
const dataPotoka = ref("");
const tel = ref("");
const PersD = ref("");
const department = ref(store.departments[0]);
const { isSnilsValid, validateSnils } = useSnilsValidator(snils);
// select options
const klasses = ref(["3", "4", "5", "6", "7", "8", "9", "10", "11"]);
const dataPotokas = ref([
  "1 поток - 01.06-12.06",
  "2 поток - 16.06-27.06",
  "3 поток - 02.07-13.07",
  "4 поток - 17.07-28.07",
  "5 поток - 02.08-13.08",
  "6 поток - 18.08-29.08",
]);

const department_selection = computed(() => {
  return school.value == 'ПАО "ЛУКОЙЛ"';
});

const btnDisabled = computed(() => {
  if (PersD.value == false || !isSnilsValid.value) {
    return true;
  } else {
    return false;
  }
});

const computedSchool = computed(() => {
  if (department.value) {
    return department.value;
  }
  return school.value;
});

onMounted(() => {
  // btnDisabled.value=false;
  // isSnilsValid.value=false;
  if (store.placeholder) {
    let doc = store.placeholder;

    name.value = doc.imya;
    surname.value = doc.familia;
    father.value = doc.otchestvo;
    snils.value = doc.snils;
    datar.value = doc.date_rozd;
    klass.value = doc.klass;
    dataPotoka.value = doc.potok;
    tel.value = doc.telephone;

    if (store.departments.includes(doc.obshestvo)) {
      school.value = store.SpisokObshestv[0];
      department.value = doc.obshestvo;
    } else {
      school.value = doc.obshestvo;
    }
  }
});

// если snils на «oninput», тогда «checkUser» запустится автоматически.
async function checkUser() {
  validateSnils();
  if (snils.value.length > 13) {
    try {
      const res = await http.get(`/auth/check/${snils.value}`);
      if (res.data.exists) {
        popup.fire({
          icon: "error",
          title: "Ошибка",
          text: "Этот пользователь уже существует",
          timer: 1500,
          showConfirmButton: false,
        });
      }
    } catch (e) {
      console.log(e);
      popup.fire({
        icon: "error",
        title: "Ошибка",
        text: "Произошла ошибка при проверке пользователя",
        timer: 1500,
        showConfirmButton: false,
      });
    }
  }
}

// sign up
async function signUp() {
  let user = {
    ...store.user,
    familia: surname.value,
    imya: name.value,
    otchestvo: father.value,
    dateRozdenia: datar.value,
    snils: snils.value,
    obshestvo: department_selection.value ? department.value : school.value,
    klass: klass.value,
    napravl: "",
    potok: document.querySelector("#dataPotoka").value,
    telefon: tel.value,
  };

  try {
    const res = await http.post(`/auth/register/`, user);

    if (res.data) {
      store.setUser(res.data.user);
      store.setDostiz([]);
      router.push("/");

      popup.fire({
        icon: "success",
        title: "Отлично",
        text: "Внесите достижения и выберите программу обучения, нажав на одну из цветных кнопок. Не забудьте отправить результаты",
        confirmButtonText: "OK",
      });
    }
  } catch (e) {
    console.log(e);
    popup.fire({
      icon: "error",
      title: "Ошибка",
      text: "Произошла ошибка при регистрации",
      timer: 1500,
      showConfirmButton: false,
    });
  }
}

// alert if user found
function showToast() {
  let toastMixin = popup.mixin({
    toast: true,
    icon: "success",
    title: "General Title",
    animation: false,
    position: "top",
    showConfirmButton: false,
    timer: 3000,
    timerProgressBar: true,
    didOpen: (toast) => {
      toast.addEventListener("mouseenter", popup.stopTimer);
      toast.addEventListener("mouseleave", popup.resumeTimer);
    },
  });

  toastMixin.fire({
    animation: true,
    title: "Пользователь найден",
  });
}
</script>

<style scoped>
.PersDannie {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 10px;
}

.PersDannie input {
  width: 40px;
  height: 40px;
}
</style>
